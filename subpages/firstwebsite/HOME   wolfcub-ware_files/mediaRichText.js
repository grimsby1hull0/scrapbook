define("mediaRichText",["lodash","coreUtils","santa-components","componentsCore","wixappsCore","create-react-class","utils","compUtils"],function(e,t,n,o,i,r,a,s){return function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(o,i,function(t){return e[t]}.bind(null,i));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=921)}({0:function(t,n){t.exports=e},1:function(e,n){e.exports=t},12:function(e,t){e.exports=i},13:function(e,t){e.exports=r},16:function(e,t){e.exports=a},2:function(e,t){e.exports=n},22:function(e,t){e.exports=s},3:function(e,t){e.exports=o},921:function(e,t,n){var o,i;o=[n(0),n(3),n(1),n(22),n(13),n(12),n(2),n(922),n(924),n(925)],void 0===(i=function(e,t,n,o,i,r,a,s,p,c){"use strict";var l=i({displayName:"wixMusicEmbed",mixins:[c],render:function(){return a.utils.createReactElement("iframe",y(this.getIframeProps()))}}),m=n.fragment,u=a.utils.textComponentsUtils,d={wline:"div"};function h(e,t){try{return function(e,t){var n=JSON.parse(e.replace(/&quot;/g,'"'));return n.url=t,n}(e,t)}catch(t){return void this.props.siteAPI.reportBI(s.MEDIA_RICH_TEXT_WRONG_COMP_DATA,{wixCompJson:e,errorDesc:t.message,errorStack:t.stack})}}function y(t){return e.assign(t,{wixComp:!0})}function f(t){return e.isFunction(t.type)&&t.props.wixComp}function g(e){return e.replace(/^#/,"")}function v(t){var n,o,i,r=this.props.siteData,a=this.props.id,s=this._getMediaRichTextComponentWidth(),p=(n=t,o=s,(i=e.get(n,"structure.layout",{})).width&&(i.width=Math.min(o,i.width)),e.assign({},n.structure,{dataItem:n.compData,propertiesItem:n.compProp,layout:i,id:n.structure.id,type:n.structure.componentType,structure:n.structure})),c=p.id;r.registerMediaRichTextInnerComponent(a,c,p)}var w={displayName:"MediaRichText",mixins:[a.mixins.textCompMixin],propTypes:{rootNavigationInfo:a.santaTypesDefinitions.Component.rootNavigationInfo.isRequired,getComponentProps:r.CoreSantaTypes.getComponentProps.isRequired},allowIframes:!0,convertCompDataTextToHTML:function(t){this.componentDataQueryList=e.map(t.compData.componentDataList||[],g),this._compData=t.compData,this._componentHtml=this._componentHtml.replace(/\n|\r|\t/g,""),this._componentHtml=u.convertDataQueryLinksIntoHtmlAnchors(this._componentHtml,t.compData.linkList,e.partialRight(n.linkRenderer.renderLink,t.siteData,t.rootNavigationInfo)),this._componentHtml=u.mobileTextTransformIfNeeded(this._componentHtml,{brightness:e.get(t,"compProp.brightness"),isMobileView:t.siteData.isMobileView(),scale:e.get(t,"structure.layout.scale"),fontGetter:t.siteData.getFont.bind(t.siteData),colorGetter:t.siteData.getColor.bind(t.siteData)}),this.renderedDataQueries={},this._componentHtml=this._convertComponentsPlaceHoldersToRenderedComponents(this._componentHtml),e.size(this.renderedDataQueries)!==e.size(this.componentDataQueryList)&&e(this.componentDataQueryList).without(e.keys(this.renderedDataQueries)).forEach(function(e){this.props.siteAPI.reportBI(s.MEDIA_RICH_MISSING_COMPONENT_PLACEHOLDER,{dataQuery:"#".concat(e)})}.bind(this)),this._registerReLayoutFunc=t.registerReLayout},_addToCompDataListIfMissing:function(t){var n=g(t);e.includes(this.componentDataQueryList,n)||this.componentDataQueryList.push(n)},_convertNodeFragmentToReactElements:function(t,n){if(t.nodeType===m.Node.ELEMENT_NODE){var o=e.reduce(t.attributes,function(t,n){return"style"===n.name?t.style=e.reduce(n.value.split(";"),function(t,n){var o=n.split(":");return 2===o.length&&(t[e.camelCase(o[0])]=o[1]),t},{}):"class"===n.name?t.className=n.value:"frameborder"===n.name?t.frameBorder=n.value:e.startsWith(n.name,"data-")?t[n.name]=n.value:t[e.camelCase(n.name)]=n.value,t},{});if(function(t,n){return t&&!e.has(d,n.tagName.toLowerCase())}(o.wixComp,t)){var i=h.call(this,o.wixComp,o.src);return i?this._handleInnerComps(i,o):""}var r=function(e){return e.childNodes&&1===e.childNodes.length&&e.childNodes[0].nodeType===m.Node.TEXT_NODE}(t)?t.textContent:e.flatMap(t.childNodes,this._convertNodeFragmentToReactElements);if(e.isArray(r)&&r.length&&e.every(r,f))return r;var s=e.includes(this.voidElements,t.tagName.toLowerCase())?o:e.assign(o,{children:r});return a.utils.createReactElement((p=t.tagName.toLowerCase(),d[p]||p),e.defaults(s,{key:"".concat(t.tagName).concat(n)}))}var p;return t.nodeType===m.Node.TEXT_NODE?t.textContent:""},voidElements:["area","base","basefont","bgsound","br","col","command","embed","frame","hr","image","img","input","isindex","keygen","link","menuitem","meta","nextid","param","source","track","wbr"],_convertComponentsPlaceHoldersToRenderedComponents:function(t){var n=m.document.createElement("div");return n.innerHTML=t,e.map(n.childNodes,this._convertNodeFragmentToReactElements)},_validateAndFixGalleryCompData:function(t,n){var o,i,r=e.clone(t),a=p.buildGalleryJsonFromCkData(n,this._compData.innerCompsData,t.style);return e.assign(r,a),o=r,i=e.cloneDeep(o.compData),o.compData.items=e.map(o.compData.items,function(t){return e.assign({galleryData:i},t)}),r},_createInnerComponentProperties:function(t,n){var o=this._createInnerComponentBasicProperties(t,n);return"wysiwyg.viewer.components.WPhoto"===n.componentType||"wysiwyg.viewer.components.Video"===n.componentType?function(t,n){return e.has(t,"post-cover-photo")&&(n.addItemProp=!0),n}(n,o):p.isGalleryComponent(n.componentType)?this._validateAndFixGalleryCompData(o,n):(this.props.siteAPI.reportBI(s.MEDIA_RICH_TEXT_UNSUPPORTED_COMPONENT,{wixCompJson:n}),o)},_getMediaRichTextComponentWidth:function(){return function(){var e=this.props.siteData.measureMap;return e&&(this._lastMeasuredWidth=e.width[this.props.id]),this._lastMeasuredWidth}.call(this)||e.get(this.props,"style.width")||630},_createInnerComponentBasicProperties:function(t,n){var o,i=function(t){var n,o=t.id||(n=t.dataQuery,"innerComp_".concat(n.replace("#","")));return e.assign(t,{id:o})}(n),r=e.get(this._compData.innerCompsData,i.dataQuery);if("wysiwyg.viewer.components.WPhoto"===i.componentType){if(i.linkDataQuery){var a=i.linkDataQuery.slice(1);r.link=e.find(this._compData.linkList,{id:a})}(o={compData:r,compProp:{displayMode:"fitWidthStrict"}}).disableImageAutoLayout=!0}else"wysiwyg.viewer.components.Video"===i.componentType&&(o={compData:r,compProp:{showControls:"temp_show",enablejsapi:1}});var s=this.props.getComponentProps(i,this.props.rootId,o);return s.style=s.style||{},s.structure=s.structure||{},s.key=s.key||n.key,s.registerReLayout=this._registerReLayoutFunc||this.registerReLayout,function(e,t){var n=e.style;n.marginTop="10px",n.marginBottom="10px",n.marginLeft=t.marginLeft,n.marginRight=t.marginRight,n.position="static"}(s,i),function(e,t){var n=t.style;e.floatValue?(n.float=e.floatValue,n.display="",n.clear=""):(n.display=e.display,n.clear="both",n.float="")}(i,s),this._calcInnerCompWidthAndHeight(i,s),s},_calcInnerCompWidthAndHeight:function(t,n){var o=this._getMediaRichTextComponentWidth(),i=o,r=n.compData&&n.compData.width,a=t.width;e.isNumber(a)?i=this._getWidthMultiplier(t)*o:e.isNumber(r)&&(i=Math.min(r,o)),n.style.width=i,t.dimsRatio?n.style.height=n.style.width*t.dimsRatio:"wysiwyg.viewer.components.Video"===t.componentType&&(n.style.height=.5625*n.style.width)},_getWidthMultiplier:function(e){return this.props.siteData.isMobileView()?.99:e.width},_handleInnerComps:function(e,t){return"htmlComp"===e.componentType?this._handleHtmlComp(e,t):"music"===e.componentType?this._handleMusicComp(e,t):this._handleInnerSantaComponent(e)},_handleInnerSantaComponent:function(e){var t=o.compFactory.getCompReactClass(e.componentType),n=this._createInnerComponentProperties(t,e);return this.renderedDataQueries[g(e.dataQuery)]=1,this._addToCompDataListIfMissing(e.dataQuery),v.call(this,n),o.compFactory.getCompClass(e.componentType,!0)(y(n))},_handleHtmlComp:function(e,t){var n,o=this.props.siteData.serviceTopology.staticHTMLComponentUrl;"website"===e.type?n="//".concat(e.websiteUrl.replace(/^(https?:)?\/\//,"")):n=("temp"===e.urlStatus?"//0.htmlcomponentservice.com/":o)+e.relativeUrl;if("center"===e.align?t.style={display:"block",clear:"both",margin:"0 auto"}:t.style={float:e.align},t.src=n,t.sandbox="allow-scripts allow-same-origin allow-popups",this.props.siteData.isMobileView()&&e.dimsRatio){if(t.width="99%",e.dimsRatio>1){var i=.99*(this._getMediaRichTextComponentWidth()?parseInt(this._getMediaRichTextComponentWidth(),10):1)*e.dimsRatio;t.height=i}}else t.width=e.width;return a.utils.createReactElement("iframe",y(t))},_handleMusicComp:function(t,n){var o=e.get(this.props.siteData,["serviceTopology","scriptsLocationMap","wix-music-embed"]),i=/^[\w\-]+$/i,r=i.test(t.paymentId)||""===t.paymentId;if(i.test(t.albumId)&&i.test(t.presetId)&&r)return n.src="".concat(o,"/index.html?albumId=").concat(t.albumId,"&paymentsId=").concat(t.paymentId,"&presetId=").concat(t.presetId,"&playerId=").concat(t.playerId,"&hideDetailedTrackInfo=true"),this.props.siteData.isMobileView()&&(n.src+="&isMobile=true"),n.sandbox="allow-scripts allow-same-origin allow-popups",n.playerId=t.playerId,delete n.wixComp,n.width="100%",a.utils.createReactElement(l,n)},componentWillUnmount:function(){this.props.siteData.clearMediaRichTextInnerComponents(this.props.id)}};return t.compRegistrar.register("wysiwyg.viewer.components.MediaRichText",w),w}.apply(t,o))||(e.exports=i)},922:function(e,t,n){var o,i;o=[n(923),n(0),n(1)],void 0===(i=function(e,t,n){"use strict";return t.forEach(e,function(e,t){e.errorName=t}),n.loggingUtils.logger.register("mediaRichText","error",e),e}.apply(t,o))||(e.exports=i)},923:function(e){e.exports=JSON.parse('{"MEDIA_RICH_TEXT_WRONG_COMP_DATA":{"errorCode":32000,"severity":"fatal","params":{"p1":"wixCompJson","p2":"errorDesc","p3":"errorStack"}},"MEDIA_RICH_TEXT_UNSUPPORTED_COMPONENT":{"errorCode":32001,"severity":"fatal","params":{"p1":"wixCompJson"}},"MEDIA_RICH_MISSING_COMPONENT_PLACEHOLDER":{"errorCode":32002,"severity":"fatal","params":{"p1":"dataQuery"}}}')},924:function(e,t,n){var o,i;o=[n(0),n(1),n(16)],void 0===(i=function(e,t,n){"use strict";var o="wysiwyg.viewer.components.MatrixGallery",i="wysiwyg.viewer.skins.gallerymatrix.BlogMatrixGallery",r="wysiwyg.viewer.components.SlideShowGallery",a="skins.viewer.gallery.BlogSlideShow",s=[o,r],p=.75;function c(e){return e===o}function l(e){return e===r}function m(e,t){var n=0;if(c(t.componentType)){var o=t.cols,i=t.rows,r=2*t.margin,a=Math.round((e-(o-1)*r)/o),s=p*a;n=Math.round(s*i)+(i-1)*r+26}else l(t.componentType)&&(n=Math.round(p*e));return n}function u(e,t){var n=e.width;return{width:n,height:m(n,t),position:"relative"}}return{buildGalleryJsonFromCkData:function(o,r,s){var p=o.componentType,m=e.assign({dataQuery:o.dataQuery,propertyQuery:o.dataQuery,componentType:o.componentType,type:"Component",style:u(s,o),compData:{type:"ImageList",items:e.map(o.imageList,function(t){var n=e.get(r,t.dataQuery);return e.assign({},t,n,{type:"Image",id:t.id+t.uri,isRef:!1,metaData:{isHidden:!1,isPreset:!0,schemaVersion:"1.0"}})}),metaData:{isPreset:!0,schemaVersion:"1.0",isHidden:!1}}},function(e){var n={};return c(e.componentType)?n={skin:i,compProp:{type:"MatrixGalleryProperties",metaData:{schemaVersion:"1.0"},expandEnabled:!0,imageMode:e.fixedSize?"clipImage":"flexibleWidthFixed",numCols:e.cols,maxRows:e.rows,incRows:2,margin:2*e.margin,alignText:"left"}}:l(e.componentType)?n={skin:a,compProp:{autoplay:e.autoplay,autoplayInterval:e.autoplayInterval,bidirectional:!1,expandEnabled:!0,imageMode:"flexibleWidthFixed",metaData:{schemaVersion:"1.0"},reverse:!1,showAutoplay:!0,showCounter:!0,showExpand:!1,showNavigation:!0,showSocial:!1,transDuration:1,transition:"swipeHorizontal",type:"SlideShowGalleryProperties"}}:t.log.error("Unknown gallery type: ".concat(e.componentType)),n}(o));return l(p)&&(m.styleId=n.santaTypes.shortenStyleId(a)),c(p)&&(m.styleId=n.santaTypes.shortenStyleId(i)),m},isGalleryComponent:function(t){return e.includes(s,t)}}}.apply(t,o))||(e.exports=i)},925:function(e,t,n){var o,i;o=[n(0)],void 0===(i=function(e){"use strict";return{getInitialState:function(){return{height:this.props.height}},onPlayerMessage:function(e){"resizeOfWixMusicIframe"===e.data.event&&e.data.playerId===this.props.playerId&&this.setState({height:e.data.size.maxHeight})},componentDidMount:function(){window.addEventListener("message",this.onPlayerMessage)},componentWillUnmount:function(){window.removeEventListener("message",this.onPlayerMessage)},getIframeProps:function(){return e.assign({},this.props,{height:this.state.height})}}}.apply(t,o))||(e.exports=i)}})});
//# sourceMappingURL=mediaRichText.min.js.map